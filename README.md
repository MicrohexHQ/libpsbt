
# libpsbt

  C library for Partially Signed Bitcoin Transactions (bip174)

## Installation

    $ make install PREFIX=out_dir

## Example

```c
static const unsigned char transaction[] = {0x02, 0x00, 0x00, 0x00, 0x02, 0x2e, 0x8c, 0x7d, 0x8d, 0x37, 0xc4, 0x27, 0xe0, 0x60, 0xec, 0x00, 0x2e, 0xc1, 0xc2, 0xbc, 0x30, 0x19, 0x6f, 0xc2, 0xf7, 0x5d, 0x6a, 0x88, 0x44, 0xcb, 0xc0, 0x36, 0x51, 0xc0, 0x81, 0x43, 0x0a, 0x01, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff, 0x96, 0xa0, 0x4e, 0x0c, 0xc6, 0x36, 0xf3, 0x77, 0x93, 0x3e, 0x3d, 0x93, 0xac, 0xcc, 0x62, 0x7f, 0xaa, 0xcd, 0xbc, 0xdb, 0x5a, 0x96, 0x24, 0xdf, 0x1b, 0x49, 0x0b, 0xd0, 0x45, 0xf2, 0x4d, 0x2c, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff, 0x01, 0xe0, 0x2b, 0xe5, 0x0e, 0x00, 0x00, 0x00, 0x00, 0x17, 0xa9, 0x14, 0xb5, 0x3b, 0xb0, 0xdc, 0x1d, 0xb8, 0xc8, 0xd8, 0x03, 0xe3, 0xe3, 0x9f, 0x78, 0x4d, 0x42, 0xe4, 0x73, 0x7f, 0xfa, 0x0d, 0x87, 0x00, 0x00, 0x00, 0x00};

// 522103c8727ce35f1c93eb0be21406ee9a923c89219fe9c9e8504c8314a6a22d1295c02103c74dc710c407d7db6e041ee212d985cd2826d93f806ed44912b9a1da691c977352ae
static const unsigned char redeem_script_a[] = {0x52, 0x21, 0x03, 0xc8, 0x72, 0x7c, 0xe3, 0x5f, 0x1c, 0x93, 0xeb, 0x0b, 0xe2, 0x14, 0x06, 0xee, 0x9a, 0x92, 0x3c, 0x89, 0x21, 0x9f, 0xe9, 0xc9, 0xe8, 0x50, 0x4c, 0x83, 0x14, 0xa6, 0xa2, 0x2d, 0x12, 0x95, 0xc0, 0x21, 0x03, 0xc7, 0x4d, 0xc7, 0x10, 0xc4, 0x07, 0xd7, 0xdb, 0x6e, 0x04, 0x1e, 0xe2, 0x12, 0xd9, 0x85, 0xcd, 0x28, 0x26, 0xd9, 0x3f, 0x80, 0x6e, 0xd4, 0x49, 0x12, 0xb9, 0xa1, 0xda, 0x69, 0x1c, 0x97, 0x73, 0x52, 0xae};

// 0020a8f44467bf171d51499153e01c0bd6291109fc38bd21b3c3224c9dc6b57590df
static const unsigned char redeem_script_b[] = {0x00, 0x20, 0xa8, 0xf4, 0x44, 0x67, 0xbf, 0x17, 0x1d, 0x51, 0x49, 0x91,  0x53, 0xe0, 0x1c, 0x0b, 0xd6, 0x29, 0x11, 0x09, 0xfc, 0x38, 0xbd, 0x21,  0xb3, 0xc3, 0x22, 0x4c, 0x9d, 0xc6, 0xb5, 0x75, 0x90, 0xdf};

#define CHECKRES(r) \
    if (r != PSBT_OK) {        \
       printf("%s\n", psbt_errmsg); \
       exit(1); \
    }

int main(int argc, char *argv[])
{
    struct psbt psbt;
    unsigned char buffer[1024] = {0};
    enum psbt_result res;

    struct psbt_record rec;

    res = psbt_init(&psbt, buffer, 1024); CHECKRES(res);

    rec.type     = PSBT_TYPE_TRANSACTION;
    rec.key      = NULL;
    rec.key_size = 0;
    rec.val      = (unsigned char*)transaction;
    rec.val_size = ARRAY_SIZE(transaction);

    res = psbt_write_global_record(&psbt, &rec); CHECKRES(res);

    rec.type     = PSBT_TYPE_REDEEM_SCRIPT;
    rec.key      = (unsigned char*)"hash160ofredeemscript";
    rec.key_size = sizeof("hash160ofredeemscript");
    rec.val      = (unsigned char*)redeem_script_a;
    rec.val_size = ARRAY_SIZE(redeem_script_a);

    res = psbt_write_global_record(&psbt, &rec); CHECKRES(res);

    rec.type     = PSBT_TYPE_REDEEM_SCRIPT;
    rec.key      = (unsigned char*)"hash160ofredeemscript";
    rec.key_size = sizeof("hash160ofredeemscript");
    rec.val      = (unsigned char*)redeem_script_b;
    rec.val_size = ARRAY_SIZE(redeem_script_b);

    res = psbt_write_global_record(&psbt, &rec); CHECKRES(res);

    // rec.type ...
    // rec.key  ...

    res = psbt_write_input_record(&psbt, &rec);  CHECKRES(res);
    res = psbt_new_input_record_set(&psbt);      CHECKRES(res);
    res = psbt_write_input_record(&psbt, &rec);  CHECKRES(res);
    res = psbt_finalize(&psbt);                  CHECKRES(res);
    res = psbt_print(&psbt, stdout);             CHECKRES(res);

    return 0;
}
```

output:

```
70736274ff007c02000000022e8c7d8d37c427e060ec002ec1c2bc30196fc2f75d6a8844cbc03651c081430a0100000000ffffffff96a04e0cc636f377933e3d93accc627faacdbcdb5a9624df1b490bd045f24d2c0000000000ffffffff01e02be50e0000000017a914b53bb0dc1db8c8d803e3e39f784d42e4737ffa0d870000000016686173683136306f6672656465656d7363726970740047522103c8727ce35f1c93eb0be21406ee9a923c89219fe9c9e8504c8314a6a22d1295c02103c74dc710c407d7db6e041ee212d985cd2826d93f806ed44912b9a1da691c977352ae16686173683136306f6672656465656d73637269707400220020a8f44467bf171d51499153e01c0bd6291109fc38bd21b3c3224c9dc6b57590df0016686173683136306f6672656465656d73637269707400220020a8f44467bf171d51499153e01c0bd6291109fc38bd21b3c3224c9dc6b57590df0016686173683136306f6672656465656d73637269707400220020a8f44467bf171d51499153e01c0bd6291109fc38bd21b3c3224c9dc6b57590df00
```

This PSBT is somewhat bogus because I have junk data in there, but you get the idea.
